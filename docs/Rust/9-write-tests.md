# Chapter 9 - Writing Automated Tests

程序的正确性是它按我们的预期运行的程度。Rust被设计为高度关注程序正确性的语言，但正确性很复杂而且不容易实现。Rust的类型系统承担了大部分的工作，但是类型系统不能够捕获所有可能的错误。因此，Rust支持编写自动测试用例。

## Section - 1 如何编写测试用例

测试用例是用来验证代码是否按预期设计运行的函数。测试用例通常包含三部分：
1. 初始化需要的数据和状态。
2. 运行需要测试的代码。
3. 断言结果是否正确。

接下来看一下Rust为编写测试用例特别提供的功能。包括`test`属性，一些宏和`should_panic`属性。

### The Anatomy of a Test Function

最简单的情况，Rust中一个测试用例就是一个带`test`参数的函数。属性是关于代码片段的元数据。在函数定义前加一行`#[test]`，这个函数就是测试用例函数。然后当你执行`cargo test`，Rust创建一个用来执行测试用例的二进制文件，这个文件会调用被`test`属性标记的函数，并且报告这些测试的结果是成功还是失败。

当我们使用`Cargo`创建库项目时，会自动生成一个测试模块，你可以自己添加其他的测试模块和函数。

首先创建一个库项目。`cargo new adder --lib`。然后可以看到默认创建好的测试模块和用例。
```rust
#[cfg(test)]
mod tests {
    #[test]
    fn it_works() {
        assert_eq!(2 + 2, 4);
    }
}
```

先把注意力集中到测试用例上。函数上面一行的`#[test]`表明这个函数是一个测试用例，test runner会在测试的时候执行这个函数。

